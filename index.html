<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chilean Salmon Mortality Data Visualization</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <!-- Header Navigation -->
    <header class="main-header">
        <nav class="navigation">
            <div class="nav-logo">
                <h1>Sernapesca Mortality Dashboard</h1>
            </div>
            <ul class="nav-links">
                <li><a href="#" class="active">Dashboard</a></li>
                <li><a href="#data">Data</a></li>
                <li><a href="#about">About</a></li>
            </ul>
        </nav>
    </header>

    <!-- Introduction Section -->
    <section class="intro-section">
        <h2 class="main-title">Chilean Salmon Mortality Trends</h2>
        <p class="description">
            Explore mortality patterns across salmon species, Chilean regions, and causes of death
            spanning 2024-2025. Compare year-over-year trends and identify critical mortality drivers
            in the aquaculture industry.
        </p>
    </section>

    <!-- Main Content Area -->
    <main class="content-wrapper">
        <!-- Chart Container -->
        <div class="chart-container">
            <div class="chart-header">
                <h3 class="chart-title">Tendencias de mortalidad por especie y región</h3>
                <div class="results-count">
                    <span id="results-count">0 Resultados</span>
                    <button class="settings-toggle" id="settings-toggle" aria-label="Mostrar configuración del gráfico">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
                        </svg>
                        Configuración
                    </button>
                </div>
            </div>

            <div id="chart" class="chart-area"></div>
        </div>

        <!-- Right Side: Selection + Filters -->
        <div class="right-column">
            <!-- Current Selection (above filter panel) -->
            <div class="current-selection-chart">
                <div class="selection-header">
                    <span class="selection-label">Selección (<span id="selection-count">0</span>)</span>
                    <button class="clear-btn" id="clear-selection">Limpiar</button>
                </div>
                <div class="selection-list" id="selection-list">
                    <p class="empty-state">No hay series seleccionadas</p>
                </div>
            </div>

            <!-- Filter Panel -->
            <aside class="filter-panel" id="filter-panel">
            <div class="panel-header">
                <h3>CONFIGURACIÓN</h3>
                <button class="panel-close" id="panel-close" aria-label="Cerrar panel">×</button>
                <button class="reset-icon" id="reset-filters" aria-label="Restablecer filtros">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 3a5 5 0 104.546 2.914.5.5 0 00-.908-.417A4 4 0 118 4a.5.5 0 000-1z"/>
                        <path d="M8 0a.5.5 0 01.5.5v2a.5.5 0 01-1 0v-2A.5.5 0 018 0z"/>
                    </svg>
                </button>
            </div>

            <!-- Filter Sections -->
            <div class="filter-sections-grid">

                <!-- Left Column: Main Filters -->
                <div class="filter-column-left">
                    <!-- Metric Type Filter -->
                    <div class="filter-section">
                        <h4 class="filter-title">Tipo de Métrica</h4>
                        <select id="metric-select" class="custom-select" name="metric">
                            <option value="total" selected>Mortalidad Total</option>
                            <option value="primary">Causas Primarias</option>
                            <option value="secondary">Enfermedades Secundarias</option>
                        </select>
                    </div>

                    <!-- Y-Axis Scale -->
                    <div class="filter-section">
                        <h4 class="filter-title">Escala del Eje Y</h4>
                        <select id="scale-select" class="custom-select" name="scale">
                            <option value="absolute" selected>Conteo Absoluto</option>
                            <option value="percentage">Porcentaje (%)</option>
                        </select>
                    </div>

                    <!-- Species Filter -->
                    <div class="filter-section">
                        <h4 class="filter-title">1. Especie</h4>
                        <div class="checkbox-group" id="species-filters">
                            <!-- Populated dynamically -->
                        </div>
                    </div>

                    <!-- Region Filter -->
                    <div class="filter-section">
                        <h4 class="filter-title">2. Región</h4>
                        <div class="checkbox-group" id="region-filters">
                            <!-- Populated dynamically -->
                        </div>
                    </div>

                    <!-- Year Filter -->
                    <div class="filter-section">
                        <h4 class="filter-title">3. Año</h4>
                        <div class="checkbox-group" id="year-filters">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Right Column: Cause Filters -->
                <div class="filter-column-right">
                    <!-- Primary Causes Filter (shown when metric=primary) -->
                    <div class="filter-section" id="primary-causes-section" style="display: none;">
                        <h4 class="filter-title">4. Causas Primarias</h4>
                        <div class="checkbox-group" id="primary-causes-filters">
                            <!-- Populated dynamically -->
                        </div>
                    </div>

                    <!-- Secondary Diseases Filter (shown when metric=secondary) -->
                    <div class="filter-section" id="secondary-diseases-section" style="display: none;">
                        <h4 class="filter-title">4. Enfermedades Secundarias</h4>
                        <div class="checkbox-group" id="secondary-diseases-filters">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                </div>

            </div>

            <!-- Warning Message -->
            <div class="warning-message" id="line-limit-warning" style="display: none;">
                ⚠️ Se pueden mostrar máximo 4 líneas. Por favor deseleccione algunas opciones.
            </div>
            </aside>
        </div>
    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <span class="attribution">CC-BY | Sernapesca 2024-2025</span>
            <div class="footer-actions">
                <button class="icon-btn" id="download-chart" aria-label="Descargar gráfico">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 12.5a.5.5 0 01-.35-.15l-3-3a.5.5 0 01.7-.7L10 11.29l2.65-2.64a.5.5 0 01.7.7l-3 3a.5.5 0 01-.35.15z"/>
                        <path d="M10 2a.5.5 0 01.5.5v10a.5.5 0 01-1 0v-10A.5.5 0 0110 2z"/>
                        <path d="M4 14a.5.5 0 01.5.5v2h11v-2a.5.5 0 011 0v2.5a.5.5 0 01-.5.5h-12a.5.5 0 01-.5-.5v-2.5A.5.5 0 014 14z"/>
                    </svg>
                </button>
                <button class="icon-btn" id="share-chart" aria-label="Compartir gráfico">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M15 13a3 3 0 00-2.1.86l-4.8-2.77a3 3 0 000-2.18l4.8-2.77a3 3 0 10-.9-1.5l-4.8 2.77a3 3 0 100 5.18l4.8 2.77A3 3 0 1015 13z"/>
                    </svg>
                </button>
            </div>
        </div>
    </footer>

    <!-- JavaScript Modules -->
    <script type="module" src="js/dataLoader.js"></script>
    <script type="module" src="js/dataTransformer.js"></script>
    <script type="module" src="js/filters.js"></script>
    <script type="module" src="js/chart.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>
