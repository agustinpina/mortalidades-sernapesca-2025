<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Análisis de Mortalidad Acuícola</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <!-- Header Navigation -->
    <header class="main-header">
        <nav class="navigation">
            <div class="nav-logo">
                <h1>Dashboard de Análisis de Mortalidad Acuícola</h1>
            </div>
        </nav>
    </header>

    <!-- Introduction Section -->
    <section class="intro-section">
        <h2 class="main-title">Análisis de Tendencias de Mortalidad</h2>
        <p class="description">
            Herramienta interactiva para visualizar y filtrar tendencias de mortalidad por especie, región y causas específicas.
        </p>
    </section>

    <!-- Filter Overlay Backdrop -->
    <div class="filter-overlay" id="filter-overlay"></div>

    <!-- Main Content Area -->
    <main class="content-wrapper">
        <!-- Chart Container (Left Column) -->
        <div class="chart-container">
            <div class="chart-header">
                <h3 class="chart-title">
                    Tendencias de mortalidad por especie y región
                    <span id="results-count">0 Resultados</span>
                </h3>
                <button class="filter-toggle-btn" id="filter-toggle-btn" aria-label="Mostrar panel de filtros">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M3 3h14a1 1 0 011 1v2a1 1 0 01-.293.707L12 12.414V17a1 1 0 01-.553.894l-2 1A1 1 0 018 18v-5.586L2.293 6.707A1 1 0 012 6V4a1 1 0 011-1z"/>
                    </svg>
                    Filtros
                </button>
            </div>

            <div id="chart" class="chart-area"></div>
        </div>

        <!-- Current Selection (Middle Column) -->
        <div class="current-selection-column">
            <div class="current-selection-chart">
                <div class="selection-header">
                    <span class="selection-label">Selección (<span id="selection-count">0</span>)</span>
                    <button class="clear-btn" id="clear-selection">Limpiar</button>
                </div>
                <div class="selection-list" id="selection-list">
                    <p class="empty-state">No hay series seleccionadas</p>
                </div>
            </div>
        </div>

        <!-- Filter Panel (Right Column) -->
        <aside class="filter-panel" id="filter-panel">
            <div class="panel-header">
                <button class="icon-btn" id="reset-filters" aria-label="Restablecer filtros">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M 7.1601562 3 L 8.7617188 5 L 18 5 C 18.551 5 19 5.448 19 6 L 19 15 L 16 15 L 20 20 L 24 15 L 21 15 L 21 6 C 21 4.346 19.654 3 18 3 L 7.1601562 3 z M 4 4 L 0 9 L 3 9 L 3 18 C 3 19.654 4.346 21 6 21 L 16.839844 21 L 15.238281 19 L 6 19 C 5.449 19 5 18.552 5 18 L 5 9 L 8 9 L 4 4 z"></path>
                    </svg>
                </button>
                <h3>CONFIGURACIÓN</h3>
                <button class="icon-btn panel-close" id="panel-close" aria-label="Cerrar panel">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L10 9.293l4.646-4.647a.5.5 0 0 1 .708.708L10.707 10l4.647 4.646a.5.5 0 0 1-.708.708L10 10.707l-4.646 4.647a.5.5 0 0 1-.708-.708L9.293 10 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                    </svg>
                </button>
            </div>

            <!-- Filter Sections -->
            <div class="filter-sections-grid">

                <!-- Left Column: Main Filters -->
                <div class="filter-column-left">
                    <!-- Metric Type Filter -->
                    <div class="filter-section">
                        <h4 class="filter-title">1. Tipo de Métrica</h4>
                        <select id="metric-select" class="custom-select" name="metric">
                            <option value="total" selected>Mortalidad Total</option>
                            <option value="primary">Causas Primarias</option>
                            <option value="secondary">Causas Secundarias</option>
                        </select>
                    </div>

                    <!-- Y-Axis Scale -->
                    <div class="filter-section">
                        <h4 class="filter-title">2. Escala del Eje Y</h4>
                        <select id="scale-select" class="custom-select" name="scale">
                            <option value="absolute" selected>Conteo Absoluto</option>
                            <option value="percentage">Porcentaje (%)</option>
                        </select>
                    </div>

                    <!-- Species Filter -->
                    <div class="filter-section">
                        <h4 class="filter-title">3. Especie</h4>
                        <div class="checkbox-group" id="species-filters">
                            <!-- Populated dynamically -->
                        </div>
                    </div>

                    <!-- Region Filter -->
                    <div class="filter-section">
                        <h4 class="filter-title">4. Región</h4>
                        <div class="checkbox-group" id="region-filters">
                            <!-- Populated dynamically -->
                        </div>
                    </div>

                    <!-- Year Filter -->
                    <div class="filter-section">
                        <h4 class="filter-title">5. Año</h4>
                        <div class="checkbox-group" id="year-filters">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Right Column: Cause Filters -->
                <div class="filter-column-right">
                    <!-- Primary Causes Filter (shown when metric=primary) -->
                    <div class="filter-section" id="primary-causes-section" style="display: none;">
                        <h4 class="filter-title">6. Causas Primarias</h4>
                        <div class="checkbox-group" id="primary-causes-filters">
                            <!-- Populated dynamically -->
                        </div>
                    </div>

                    <!-- Secondary Causes Filter (shown when metric=secondary) -->
                    <div class="filter-section" id="secondary-diseases-section" style="display: none;">
                        <h4 class="filter-title">6. Causas Secundarias</h4>
                        <div class="checkbox-group" id="secondary-diseases-filters">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                </div>

            </div>

            <!-- Warning Message -->
            <div class="warning-message" id="line-limit-warning" style="display: none;">
                ⚠️ Se pueden mostrar máximo 6 líneas. Por favor deseleccione algunas opciones.
            </div>
        </aside>
    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <span class="attribution">Fuente: Sernapesca 2024-2025</span>
            <div class="footer-actions">
                <button class="icon-btn" id="download-chart" aria-label="Descargar gráfico">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 12.5a.5.5 0 01-.35-.15l-3-3a.5.5 0 01.7-.7L10 11.29l2.65-2.64a.5.5 0 01.7.7l-3 3a.5.5 0 01-.35.15z"/>
                        <path d="M10 2a.5.5 0 01.5.5v10a.5.5 0 01-1 0v-10A.5.5 0 0110 2z"/>
                        <path d="M4 14a.5.5 0 01.5.5v2h11v-2a.5.5 0 011 0v2.5a.5.5 0 01-.5.5h-12a.5.5 0 01-.5-.5v-2.5A.5.5 0 014 14z"/>
                    </svg>
                </button>
                <button class="icon-btn" id="share-chart" aria-label="Compartir gráfico">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M15 13a3 3 0 00-2.1.86l-4.8-2.77a3 3 0 000-2.18l4.8-2.77a3 3 0 10-.9-1.5l-4.8 2.77a3 3 0 100 5.18l4.8 2.77A3 3 0 1015 13z"/>
                    </svg>
                </button>
            </div>
        </div>
    </footer>

    <!-- Share Modal -->
    <div class="modal-overlay" id="share-modal-overlay">
        <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="share-modal-title">
            <div class="modal-header">
                <h3 id="share-modal-title">Compartir Dashboard</h3>
                <button class="icon-btn modal-close-btn" id="share-modal-close" aria-label="Cerrar modal">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L10 9.293l4.646-4.647a.5.5 0 0 1 .708.708L10.707 10l4.647 4.646a.5.5 0 0 1-.708.708L10 10.707l-4.646 4.647a.5.5 0 0 1-.708-.708L9.293 10 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h4 class="modal-section-title">Copiar enlace</h4>
                    <p class="modal-section-description">Comparte este enlace para que otros vean la misma visualización.</p>
                    <div class="copy-link-group">
                        <input type="text" id="share-link-input" class="share-link-input" readonly>
                        <button class="btn-primary" id="copy-link-btn">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                                <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                            </svg>
                            Copiar
                        </button>
                    </div>
                </div>
                <div class="modal-divider"></div>
                <div class="modal-section">
                    <h4 class="modal-section-title">Contactar al desarrollador</h4>
                    <p class="modal-section-description">¿Tienes preguntas o sugerencias? Contáctame en LinkedIn.</p>
                    <a href="https://www.linkedin.com/in/agustn-pina" target="_blank" rel="noopener noreferrer" class="btn-linkedin">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                            <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"/>
                        </svg>
                        Contactar en LinkedIn
                        <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor" aria-hidden="true" class="external-icon">
                            <path d="M10.5 1h-9A.5.5 0 0 0 1 1.5v9a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5zM9 8.5L3.5 3M9 3.5H5.5M9 3.5v3.5"/>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script type="module" src="js/dataLoader.js"></script>
    <script type="module" src="js/dataTransformer.js"></script>
    <script type="module" src="js/filters.js"></script>
    <script type="module" src="js/chart.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>
